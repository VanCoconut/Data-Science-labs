24 Gennaio 2022

SELECT DATAINNAGURAZIONE,6-MESI,TEMATICA,ANNO,NOMESOCIETA, SUM(IMPORTOTATLE) AS TOTI,SUM(NOMEROORECONSULENZA) AS TOTO,SUM(NUMEROPROGETTISEGUITI) AS TOTP
FROM CONSULENZE C,TEMPO T, SOCIETA-DI-CONULENZA S
WHERE C.IDTEMPO=T.IDTEMPO AND C.IDSOCIETA=S.IDSOCIETA
GROUP BY DATAINNAGURAZIONE,NOMESOCIETA,6-MESI,ANNO, TEMATICA

CREATE OR REPLACE TRIGGER T1
AFTER INSERT ON CONSULENZE
FOR EACH ROW

DECLARE

VARD,VARN,VAR6,VARA VARCAHR(20),
N INTEGER;

BEGIN

SELECT DATAIINAGURAZIONE,NOMESOCIETA INTO VARD,VARN
FROM SOCIETA-DI.CONSULENZA
WHERE IDSOCIERTA=:NEW.IDSOCIETA

SELECT 6-MESI,ANNO INTO VAR6,VARA
FORM TEMPO
WHERE IDTEMPO=:NEW.IDTEMPO

SELECT COUNT(*) INTO N
FROM VIEW
WHERE 6-MESI=VAR6 AND VARD=DATAINNAGURAZIONE AND VARN=NOMESOCIETA AND Tematica = :NEW.Tematica;

IF(N>0)
	UPDATE VIEW
	SET TOTI+=:NEW.IMPORTOTOTALE, TOTO+=:NEW.NUMEROORECONSULENZA, TOTP+=:NEW.NUMEROPROGETTISEGUITI, 
	WHERE 6-MESI=VAR6 AND VARD=DATADIINNAGURAZIONE AND VARN=NOMESOCIETA AND Tematica = :NEW.Tematica;

ELSE
	INSERT INTO VIEW(...) VALUES 	(VARD,VARN,VAR6,VARA,:NEW.TEMATICA,:NEW.IMPORTOTOTALE,:NEW.NUMEROORECONSULENZA,:NEW.NUMEROPROGETTISEGUITI)
END IF 
END

SELECT S.CITTA,MESE, SUM(NUMEROCONSULENTI)/SUME(NUMEROPROGETTISEGUITI), 
100*SUM(IMPORTOTOTALE)/SUM(SUM(IMPORTOTOTALE)) OVER (PARITTION BY MESE,S.REGIONE),
SUM(SUM(NUMEROORECONSULENZA)) OVER (PARTITION BY ANNO,S.CITTA ORDER BY MESE ROW UNBOUNDED PRECEDING)
COUNT(DISTINCET TEMATICHE)

FROM SOCIETA-DI-CONSULENZA S, CONSULENZE C, TEMPO T
WHERE S.REGIONE="LIGURIA" AND C.IDTEMPO=T.IDTEMPO AND S.IDSOICETA=C.IDSOCIETA
GROUP BY S.CITTA, MESE, ANNO,S.REGIONE

SELECT DATA,S.REGIONE,SUM(IMPORTOTOTALE),SUM(NUMEROORECOSNULENZA)/SUM(NUMEROCONSULENTI),
	RANK() OVER (PARITTION BY DATA ORDER BY SUM(NUMEROORECONSULENZA)/SUM(NUMEROCONSULENTI) DESC)

FROM  SOCIETA-DI-CONSULENZA S, CONSULENZE C,TEMPO T
WHERE (S.STATO="ITALIA" OR S.STATO="GERMANIA") AND TEMATICA="INTELIGGENZA ARTIFICAIALE" AND MESE="12/21" AND
	S.IDSOCIETA=C.IDSOCIETA AND T.IDTEMPO=C.IDTEMPO
GROUP BY DATA,S.REGIONE

SELECT TIPOAZIENDA,TEMATICA,MESE,
	COUNT(DISTINCT REIONE),SUM(SUM(NUMEROORECONSULENZA)) OVER (PARTION BY TEMATICA),
	RANK () OVER(PARTITION BY  MESE ORDER BY SUM(NUMEROORECOSNULENZA) ASC)

FROM CONSULENZE C, TMEPO T,AZIENDE A
WHERE ANNO<2021 AND STATO="ITALIA" AND C.IDTEMPO=T.IDTEMPO AND C.IDAZINEZA=A.IDAZIENDA
GROUP BY TIPOZAZIENDA, TEMATICA,MESE