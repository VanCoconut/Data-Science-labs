ESAME 2023-01-23

SELECT SUM(#ACQUISTI),SUM(VALOREACQUISTI), NAZIONALITA,PROPENSIONEALRISCHIO,2-MESI,6-MESI,ANNO, CITTA,REGIONE
FROM INTERMEDIARIO-FINANZIARIO I,JUMK-CARATTERISTICHE-CLIENTE J, TEMPO T,ACQUISTO A
WHERE I.IDINTERMEDIARIOFINANZIARIO=A-IDINTERMEDIARIOFINANZIARIO AND T.IDTEMPO=A.IDTEMPO AND J.IDJCC=A.IDJCC 
GROUP BY NAZIONALITA,PROPENSIONERISCHIO,2-MESI,REGIONE,ANNO,CITTA,6-MESI

TRIGGER

SELECT NAZIONALITA,PROPENSIONEALRISCHIO INT VARN,VARP
FROM CARATT
WHERE ID=:NEW.ID

SELECT CITTA,REGIONE INTO VARC,VARR
FROM I
WHERE ID=:NEW.ID

SELECT 2-MESI,6-MESI,ANNO 
FROM TEMPO
WHERE ID=:NEW.ID

SELECT COUNT(*) INTO N
FROM VIEW
WHERE VAR2=2-MESI AND VARC=CITTA AND VARN=NAZIONALITA AND VARP=PROPENSIONE

N>0
	UPDATE VIEW
	SET TOTA+=:NEW.#ACQUISTI, TOTV+=NEW.VALOREACQUISTI
	WHERE VAR2=2-MESI AND VARC=CITTA AND VARN=NAZIONALITA AND VAR=PROPENSIONE
	
ELSE
	INSERT INTO VIEW (.....) VALUES (VARC,VARR,VARN,VARP,VAR2,VAR6,VARA, :NEW.#ACQUISTI,:NEW.VALROEACQUISTI)





