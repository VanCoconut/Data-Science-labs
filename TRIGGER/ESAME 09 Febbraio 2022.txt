ESAME 09 Febbraio 2022

SELECT STATOCENTRO, SUM(NUMEROGIORNI) AS TOTG, SUM(COSTOTOTALE) TOTC, TIPORESTAURO, ANNO, 6-MESI,REGIONECENTRO,CATEGORIAINNOVAZIONE
FROM RESTAURO R, TEMPO T, TIPO-RESTAURO TR,CENTRO-RESTAURO C,
WHERE R.IDCENTRO=C.IDCENTRO AND R.IDTEMPO=T.IDTEMPO AND R.IDTIPORESTAURO=TR.IDTIPORESTAURO
GROUP BY 6-MESI,ANNO,REGIONECENTRO,STATOCENTRO,TIPORESTAURO,CATEGORIAIINOVAZIONE

CREATE OR REPLACE TRIGGER T1
AFTER INSERT ON RESTAURO
FOR EACH ROW

DECLARE
N INTEGER,
VAR6,VARA,VARR,VARS,VART,VARC VARCHAR(20);

BEGIN

SELECT 6-MESI, ANNO INTO VAR6,VARA
FROM TEMPO
WHERE IDTEMPO=:MEW.IDTEMPO

SELECT REGIONECENTRO,STATOCENTRO INTO VARR,VARS
FROM CENTRO-RESATURO
WHERE IDCENTRO=:NEW.IDCENTO

SELECT TIPORESATURO,CATEGORIAINNOVAZIONE INT VART,VARC
FROM TIPO-RESTAURO
WHERE IDTIPORESTAURO=:NEW.IDTIPORESTAURO

SELECT COUNT(*) INTO N
FROM VIEWCENTRORESTAURO
WHERE VAR6=6.MESI AND VARR=REGIONECENTRO AND VART=TIPORESTAURO

IF(N>0)
	UPDATE VIEWCENTRORESTAURO
	SET TOTC+=:NEW.COSTOTOTALE , TOTG+=:NEW.NUMEROGIORNI 
	WHERE VAR6=6-MESI AND VARR=REGIONE AND VART=TIPORESTAURO
ELSE 
	INSERT INTO VIEWCENTRORESTAURO(...) VALUES 	(VAR6,VARA,VARR,VARS,VART,VARC,:NEW.COSTOTOTALE,:NEW.NUEMROGIORNI)
END IF
END