ESAME 22/08/31
SELECT SUM(IncassoTotale) TOTIS, SUM(NUMEROOREEROGATE) AS TOTO,TIPOCERTITFICAZIONE, ANNO, LIVELLOCERTIFICAZIONE,SUM(NUMEROISCRITTI) TOTI,6-MESI,PROFESSIONE,
	GENERE,SUM(NUMEROTOTALESUPERI) TOTS,3-MESI,FASCIAETA
FROM EROGAZIONE-CORSI E, TEMPO T, CARATTERISTICHE-CORSO-CERTIFICAZIONE CC, CARATTERISTICHE-ISCRITTI CI
WHERE E.IDTEMPO=T.IDTEMPO AND E.IDCARATTCOSOCERT=CC.IDCARATTCORSOCERT AND E.IDCARATTISCRITTI=CI.IDCARATTISCRITTI
GROUP BY 3-MESI,6-MESI,ANNO,TIPOCERTITIFCAZIONE, LIVELLOCERTITFICAZIONE, PROFESSIONE, GENERE, FASCIAETA

CREATE OR REPLACE TRIGGER T1
AFTER INSERT ON EROGAZIONE-CORSI
FOR EACH ROW

DECLERE

VAR3MESI,VAR6MESI,VARANNO DATE;
VARG,VARE,VARP,VARL,VART VARCHAR(20);
N INTEGER;

BEGIN

SELECT 3M-MESI,6-MESI,ANNO
INTO VAR3MESI,VAR6MESI,VARANNO
FROM TEMPO 
WHERE IDTEMPO=:NEW.IDTEMPO

SELECT GENERE,FASCIAETA,PROFESSIONE
INTO VARG,VARE,VARP
FROM CARATTERISTICHE-ISCRITTI
WHERE IDCARATTISCRITTI=:NEW.IDCARATTISCRITTI

SELECT LIVELLOCERTIFICAZIONE, TIPOCERTIFICAZIONE
INTO VARL,VART
FROM CARATTERISTICHE-CORSO-CERTIFICAZIONE
WHERE IDCARATTCORSOCERT=:NEW.IDCARATTCORSOCERT

SELECT COUNT(*) INTO N
FROM VIEW
WHERE 3-MESI=VAR3MESI AND VARG=GENERE AND VARP=PROFESSIONE AND VARE=FASCIAETA AND VART=TIPOCERTIFICAZIONE AND VARL=LIVELLOCERTIFICAZIONE

IF(N>0) 
	UPDATE VIEW
	SET TOTI+=:NEW.NUMEROISCRITTI, TOTO+=:NEW.NUMEROOREEROGATE, TOTS+=:NEW.NUMEROSUPERI, TOTIS+=:NEW.INCASSOTOTALE
	WHERE 3-MESI=VAR3MESI AND VARG=GENERE AND VARP=PROFESSIONE AND VARE=FASCIAETA AND VART=TIPOLOGIACERTIFICAZIONE AND 	VARL=LIVELLOCERTITFICAZIONE
ELSE
	INSERT INTO VIEW (...) VALUES (VAR3MESI,VAR6MESI,VARANNO,VART,VARL,VARP,VARG,VARE,:NEW.INCASSOTALE,:NEW.NUMEROOREEROGATE,:NEW.NUMEROISCRITTI,:NEW.NUMEROSUPERI)
END IF
END